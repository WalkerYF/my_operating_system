# 第四周的开发日志





## 日志

将代码转移到tty.c的时候，发现代码像出了问题，每一次运行的结果都不同。
后来发现是自己分配的栈指针太小，修改了代码段。将kernel中的`mov sp 0x400`改成`mov sp 0x2000`就好了。

### tty开发记录

感觉还是蛮好写的，毕竟自己以前封装写的函数都很好用。
就是在回退删除内容那一块一时半会没有解决，后来灵机一动，改了一点点代码，搞定了！


### 中断系统

想法：
改写一个int 40中断，让该中断指向一个内核自定义的程序。
该程序能够保存终端状态，并且跳转到一个指定的程序运行。
（该指定程序由一个索引寄存器索引到一个表中，该表存有各自定义中断例程的地址。

### 问题来了

这个中断会调用一个call far 修改 cs和ip寄存器，然后跳转到指定函数。
该函数是用c写的，汇编之后，似乎只能生成ret，而不能生成retf

暂时将这个中断系统做成只取偏移量，不取段地址的形式。
还是无法解决C中调用函数无法实现段的跳转的问题。

事实上，c中无法实现段间的跳转是很正常的。在orange中，他是通过创建页表的方式修改地址的映射，以实现内存分段管理，而c程序无需关心自己在那个段，也无需关心自己调用的中断的代码是否处在这个段。

不修改段！