     1                                  ;程序源代码（myos1.asm）
     2                                  ; org  7c00h		; BIOS将把引导扇区加载到0:7C00h处，并开始执行
     3                                  %include "../include/macro.inc"
     4                              <1> kernel_code_segment equ 0x1000
     5                              <1> kernel_code_entry equ 0x0000
     6                              <1> 
     7                              <1> 
     8                              <1> core_header_data_segment equ 0100h
     9                              <1> core_code_entry_header_offset equ 0x2A
    10                              <1> core_code_segment_header_offset equ 0x2C
    11                              <1> core_data_segment_header_offset equ 0x2E
    12                              <1> core_stack_segment_header_offset equ 0x30
    13                              <1> core_stack_length equ 256
    14                              <1> core_entry_header_offset equ 0x32
    15                              <1> user1_program_address equ 0x2000
    16                              <1> user2_program_address equ 0x3000
    17                              <1> user3_program_address equ 0x4000
    18                              <1> user4_program_address equ 0x5000
    19                              <1> 
    20                              <1> user1_bound_x_up equ 1 
    21                              <1> user1_bound_x_down equ 12
    22                              <1> user1_bound_y_left equ 1
    23                              <1> user1_bound_y_right equ 39 
    24                              <1> 
    25                              <1> user2_bound_x_up equ 1 
    26                              <1> user2_bound_x_down equ 12
    27                              <1> user2_bound_y_left equ 40
    28                              <1> user2_bound_y_right equ 78 
    29                              <1> 
    30                              <1> user3_bound_x_up equ 13 
    31                              <1> user3_bound_x_down equ 23
    32                              <1> user3_bound_y_left equ 1
    33                              <1> user3_bound_y_right equ 39
    34                              <1> 
    35                              <1> user4_bound_x_up equ 13 
    36                              <1> user4_bound_x_down equ 23
    37                              <1> user4_bound_y_left equ 40
    38                              <1> user4_bound_y_right equ 78 
    39                                  section my_mbr vstart=0x7c00
    40                                  
    41                                  Start:
    42 00000000 B80006                  	mov	ax, 0600h  ; %ah=6, %al=0
    43 00000003 BB0007                  	mov	bx, 0700h  ; Black white
    44 00000006 B90000                  	mov	cx, 0      ;  Top left: (0,0)
    45 00000009 BA4F18                  	mov	dx, 184fh  ; Bottom right: (80,50)
    46 0000000C CD10                    	int	10h        ; BIOS int 10h, ah=6: Initialize screen
    47                                  
    48 0000000E 668CC8                  	mov eax, cs	       ; 置其他段寄存器值与CS相同
    49 00000011 8ED8                    	mov ds, ax	       ; 数据段
    50 00000013 8EC0                    	mov es, ax		 ; 置ES=DS
    51                                      ; 显示字符串
    52                                      ; 此时es 就是0，与cs相同
    53 00000015 66B801130000            	mov eax, 1301h		 ; AH = 13h（功能号）、AL = 01h（光标置于串尾）
    54 0000001B 66BB07000000            	mov ebx, 0007h		 ; 页号为0(BH = 0) 黑底白字(BL = 07h)
    55 00000021 B200                    	mov dl, 0			 ; 列号=0
    56 00000023 B600                    	mov dh, 0		       ; 行号=0
    57 00000025 B92300                  	mov cx, MessageLength  ; CX = 串长（=9）
    58 00000028 BD[4D00]                	mov bp, Message		 ; BP=当前串的偏移地址
    59 0000002B CD10                    	int 10h			 ; BIOS的10h功能：显示一行字符
    60                                  LoadnEx:
    61                                       ;读软盘或硬盘上的若干物理扇区到内存的ES:BX处：
    62 0000002D 66B800010000            	mov eax,core_header_data_segment                ;段地址 ; 存放数据的内存基地址
    63 00000033 8EC0                    	mov es,ax                ;设置段地址（不能直接mov es,段地址）
    64 00000035 BB0000                  	mov bx,0 ;偏移地址; 存放数据的内存偏移地址
    65 00000038 B402                    	mov ah,2                 ; 功能号
    66 0000003A B00A                    	mov al,10                 ;扇区数
    67 0000003C B200                    	mov dl,0                 ;驱动器号 ; 软盘为0，硬盘和U盘为80H
    68 0000003E B600                    	mov dh,0                 ;磁头号 ; 起始编号为0
    69 00000040 B500                    	mov ch,0                 ;柱面号 ; 起始编号为0
    70 00000042 B102                    	mov cl,2                 ;起始扇区号 ; 起始编号为1
    71 00000044 CD13                    	int 13H ;                调用读磁盘BIOS的13h功能
    72                                  	; 系统内核已加载到指定内存区域中
    73                                  ; 转入系统内核
    74                                  redirect:
    75 00000046 EBFE                    	jmp $
    76 00000048 EA00000010              	jmp kernel_code_segment:kernel_code_entry
    77                                  	; jmp 1000:0000
    78                                  
    79                                  Message:
    80 0000004D 48656C6C6F2C204D79-     	db 'Hello, MyOs is loading system core.'
    81 00000056 4F73206973206C6F61-
    82 0000005F 64696E672073797374-
    83 00000068 656D20636F72652E   
    84                                  
    85                                  MessageLength  equ ($-Message)
    86 00000070 00<rept>                times 510-($-$$) db 0
    87 000001FE 55AA                    db 0x55,0xaa
    88                                  
    89                                  
    90                                  
    91                                  
    92                                  
