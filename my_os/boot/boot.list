     1                                  ;程序源代码（myos1.asm）
     2                                  ; org  7c00h		; BIOS将把引导扇区加载到0:7C00h处，并开始执行
     3                                  %include "../include/macro.inc"
     4                              <1> loader_code_segment equ 0x1000
     5                              <1> loader_code_entry equ 0x0000
     6                              <1> 
     7                              <1> 
     8                              <1> core_header_data_segment equ 0100h
     9                              <1> core_code_entry_header_offset equ 0x2A
    10                              <1> core_code_segment_header_offset equ 0x2C
    11                              <1> core_data_segment_header_offset equ 0x2E
    12                              <1> core_stack_segment_header_offset equ 0x30
    13                              <1> core_stack_length equ 256
    14                              <1> core_entry_header_offset equ 0x32
    15                              <1> user1_program_address equ 0x2000
    16                              <1> user2_program_address equ 0x3000
    17                              <1> user3_program_address equ 0x4000
    18                              <1> user4_program_address equ 0x5000
    19                              <1> 
    20                              <1> user1_bound_x_up equ 1 
    21                              <1> user1_bound_x_down equ 12
    22                              <1> user1_bound_y_left equ 1
    23                              <1> user1_bound_y_right equ 39 
    24                              <1> 
    25                              <1> user2_bound_x_up equ 1 
    26                              <1> user2_bound_x_down equ 12
    27                              <1> user2_bound_y_left equ 40
    28                              <1> user2_bound_y_right equ 78 
    29                              <1> 
    30                              <1> user3_bound_x_up equ 13 
    31                              <1> user3_bound_x_down equ 23
    32                              <1> user3_bound_y_left equ 1
    33                              <1> user3_bound_y_right equ 39
    34                              <1> 
    35                              <1> user4_bound_x_up equ 13 
    36                              <1> user4_bound_x_down equ 23
    37                              <1> user4_bound_y_left equ 40
    38                              <1> user4_bound_y_right equ 78 
    39                                  section my_mbr vstart=0x7c00
    40                                  
    41                                  Start:
    42 00000000 8CC8                    	mov ax, cs	       ; 置其他段寄存器值与CS相同
    43 00000002 8ED8                    	mov ds, ax	       ; 数据段
    44 00000004 8EC0                    	mov es, ax		 ; 置ES=DS
    45                                      ; 此时es 就是0，与cs相同
    46                                  ;------------------------------------------
    47                                  ; 清屏
    48 00000006 B80006                  	mov	ax, 0600h  ; ah=6, al=0
    49 00000009 BB0007                  	mov	bx, 0700h  ; Black white
    50 0000000C B90000                  	mov	cx, 0      ;  Top left: (0,0)
    51 0000000F BA4F18                  	mov	dx, 184fh  ; Bottom right: (79,24)
    52 00000012 CD10                    	int	10h        ; BIOS int 10h, ah=6: Initialize screen
    53                                  
    54                                  ;-----------------------------------------------
    55                                  ; 显示字符串
    56 00000014 66B801130000            	mov eax, 1301h		 ; AH = 13h（功能号）、AL = 01h（光标置于串尾）
    57 0000001A 66BB07000000            	mov ebx, 0007h		 ; 页号为0(BH = 0) 黑底白字(BL = 07h)
    58 00000020 B200                    	mov dl, 0			 ; 列号=0
    59 00000022 B600                    	mov dh, 0		       ; 行号=0
    60 00000024 B92300                  	mov cx, MessageLength  ; CX = 串长（=9）
    61 00000027 BD[4700]                	mov bp, Message		 ; BP=当前串的偏移地址
    62 0000002A CD10                    	int 10h			 ; BIOS的10h功能：显示一行字符
    63                                  ; 将(1,0,1-18)加载器加载到0x1000:0x0000 即0x10000处
    64                                  LoadnEx:
    65                                       ;读软盘或硬盘上的若干物理扇区到内存的ES:BX处：
    66 0000002C B80010                  	mov ax,loader_code_segment                ;段地址 ; 存放数据的内存基地址
    67 0000002F 8EC0                    	mov es,ax                ;设置段地址（不能直接mov es,段地址）
    68 00000031 BB0000                  	mov bx,0 ;偏移地址; 存放数据的内存偏移地址
    69 00000034 B402                    	mov ah,2                 ; 功能号
    70 00000036 B012                    	mov al,18                 ;扇区数 ；
    71 00000038 B200                    	mov dl,0                 ;驱动器号 ; 软盘为0，硬盘和U盘为80H
    72 0000003A B600                    	mov dh,0                 ;磁头号 ; 起始编号为0
    73 0000003C B501                    	mov ch,1                 ;柱面号 ; 起始编号为0
    74 0000003E B101                    	mov cl,1                 ;起始扇区号 ; 起始编号为1
    75 00000040 CD13                    	int 13H ;                调用读磁盘BIOS的13h功能
    76                                  	; 系统内核已加载到指定内存区域中
    77                                  ; 转入系统内核
    78                                  redirect:
    79                                  	; jmp $
    80 00000042 EA00000010              	jmp loader_code_segment:loader_code_entry
    81                                  
    82                                  Message:
    83 00000047 48656C6C6F2C204D79-     	db 'Hello, MyOs is loading system core.'
    84 00000050 4F73206973206C6F61-
    85 00000059 64696E672073797374-
    86 00000062 656D20636F72652E   
    87                                  
    88                                  MessageLength  equ ($-Message)
    89 0000006A 00<rept>                times 510-($-$$) db 0
    90 000001FE 55AA                    db 0x55,0xaa
    91                                  
