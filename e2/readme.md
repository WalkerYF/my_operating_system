# 操作系统实验2


## 工具链及依赖

这里是我开发操作系统的工具链平台。
可能会用到qemu虚拟机，当然不安装qemu也行，本代码仓库内置了bochs虚拟机。

## 实验二，实验要求

设计四个（或更多）有输出的用户可执行程序
    设计四个有输出的用户可执行程序，分别在屏幕1/4区域动态输出字符，如将用字符‘A’从屏幕左边某行位置45度角下斜射出，保持一个可观察的适当速度直线运动，碰到屏幕相应1/4区域的边后产生反射，改变方向运动，如此类推，不断运动；在此基础上，增加你的个性扩展，如同时控制两个运动的轨迹，或炫酷动态变色，个性画面，如此等等，自由不限。还要在屏幕某个区域特别的方式显示你的学号姓名等个人信息。
修改参考原型代码，允许键盘输入，用于指定运行这四个有输出的用户可执行程序之一，要确保系统执行代码不超过512字节，以便放在引导扇区 
自行组织映像盘的空间存放四个用户可执行程序。

1. 四个用户程序（使用q退回到主菜单）
    1. 不断反弹的笑脸，这个保留下来，每调用一次反弹函数，就移动一步。
    1. 左右滚动的姓名和学号字符串，考虑使用延时过程，修改时间。（也是很好实现）
    1. 转圈圈的小蛇（后期可改成贪吃蛇）（已经想到了实现方法）
    1. 打飞机游戏！

## 想法

引导程序：加载第二第三个扇区，里面有加载器，或者说是系统内核。
1. 加载系统内核第1,2个扇区（这里应该是写死的)
1. ds：
1. ss，sp
1. 系统内核代码段->
1. 跳转，cs和ip分别制成
1. 引导程序顺利跳转到内核，需要确定

系统内核：目前的重点，是如何编写一个系统内核?
1. 内核的主要功能应该是：
    1. 代码段
    1. 公用例程
    1. 尾部（用于计算内核长度）
1. 在内核中运行的程序，应该有一个独立的数据段，代码段，还有内核的系统调用
    1. 设置cs，ds，es
加载器：有四个选项，定位jkl;吧。
每一个选项，能够加载一个用户程序

系统内核框架已经完成，现在剩下的是，如何加载用户程序，如何在用户程序执行的时候能够返回来。
1. 修改时钟中断，实现每个时钟中断都检测键盘缓冲区是否有字符，若有字符，则检查是否是q，若是q，则返回来，并将时钟中断的地址还原，若不是q，不管，什么是都不做，退出。
1. 在用户程序加上程序尾，用于跳回内核（就像dos中的 mov ax, 4c00h, int 21h)修改一个中断，让这个中断实现将控制权交回给系统内核的操作。


中断已经成功学会安装，也成功调用
但是有个问题，CPU的状态与中断调用的结果有关（涉及到段寄存器）
因此中断一定要设计的，与CPU的状态无关，无论状态是什么，执行的结果都一样

当调用中断，先将标志寄存器push进栈中，然后push段地址，然后push偏移地址
成功通过调用中断返回内核,已确认能够返回

第二个任务：设计用户程序，做到用户程序无需关心该程序在内存中的位置。 或者说是加载到固定位置，比如说固定加载到10000h这个位置。然后在转到用户程序的时候，段寄存器又该如何设置呢？
cs，ds，es，ss，sp
参考加载.com文件的方式
我要写一个过程
该过程输入扇区号
完成将固定 扇区数的用户程序载入内存固定位置，并运行之

加载用户程序没什么问题了，剩下的工作是美工。

1. 内核菜单美化
1. 使用参数，控制A的弹跳范围，形成四个用户子程序

问题在于：每个程序只能加载到同一块区域，不能够并发的执行


做一个这样的函数
输入x,y,es:bp, 显示一行字符串